var MusicAPM=function(){"use strict";function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return void 0===e}function C(e,t){var n,i,a,o;if(r(e.length))for(n in e)a=e,o=n,Object.prototype.hasOwnProperty.call(a,o)&&t(n,e[n]);else if(i=e.length)for(n=0;n<i;n++)t(n,e[n])}function d(n,e){return e&&C(e,function(e,t){n[e]=t}),n}function t(){var e=window.crypto||window.msCrypto;if(r(e)||!e.getRandomValues)return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}function p(n,e){return n&&e?(a=e,"[object String]"===Object.prototype.toString.call(a)||e instanceof RegExp?n.replace(e,""):(i=e,"[object Object]"===Object.prototype.toString.call(i)&&e.rule&&e.target?n.replace(e.rule,e.target):(t=e,"[object Function]"===Object.prototype.toString.call(t)?e(n):(o(e)&&C(e,function(e,t){n=p(n,t)}),n)))):n;var t,i,a}function i(e){var t=/\?(.+)/.exec(e),n=t&&t[1],i={};return n&&C(n.split("&"),function(e,t){var n=t.split("=");i[n[0]]=n[1]||""}),i}function e(e,t){return"imageView"in(t=t||i(e))||!!t.param&&/^\d+[xyz]\d+$/.test(t.param)}function s(){return!!window.PRELOAD}function R(e){if(!e)return"";var t={};return t.className=e.className||"",t.id=e.id||"",t.nodeName=e.nodeName||"",t}var c={};try{c.Set=Set}catch(e){!function(n,t){var e=t(i.prototype,{size:{configurable:!0,get:function(){return this._v.length}}});function i(e){t(this,{_v:{value:[]}}),e&&e.forEach(this.add,this)}function a(e,t){return-1<(n=e._v.indexOf(t))}function o(e){return[e,e]}e.add=function(e){return a(this,e)||this._v.push(e),this},e.clear=function(){var e=this._v.length;this._v.splice(0,e)},e.delete=function(e){return a(this,e)&&!!this._v.splice(n,1)},e.entries=function(){return this._v.map(o)},e.forEach=function(n,i){this._v.forEach(function(e,t){n.call(i,e,e,this)},this)},e.has=function(e){return a(this,e)},e.keys=e.values=function(){return this._v.slice(0)},c.Set=i}(0,Object.defineProperties)}var n=c.Set;"function"!=typeof window.Set&&(window.Set=n),Array.prototype.filter||(Array.prototype.filter=function(e,t){if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var n=this.length>>>0,i=new Array(n),a=this,o=0,r=-1;if(void 0===t)for(;++r!==n;)r in this&&e(a[r],r,a)&&(i[o++]=a[r]);else for(;++r!==n;)r in this&&e.call(t,a[r],r,a)&&(i[o++]=a[r]);return i.length=o,i}),Array.prototype.map||(Array.prototype.map=function(e){var t,n,i;if(null==this)throw new TypeError("this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(t=arguments[1]),n=new Array(o),i=0;i<o;){var r,s;i in a&&(r=a[i],s=e.call(t,r,i,a),n[i]=s),i++}return n});var k,D,a,A,I=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},x=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var n=new PerformanceObserver(function(e){return e.getEntries().map(t)});return n.observe({type:e,buffered:!0}),n}}catch(e){}},u=!1,M=function(n,i){u||"undefined"!=typeof InstallTrigger||(addEventListener("beforeunload",function(){}),u=!0),addEventListener("visibilitychange",function e(t){"hidden"===document.visibilityState&&(n(t),i&&removeEventListener("visibilitychange",e,!0))},!0)},q=function(t){addEventListener("pageshow",function(e){e.persisted&&t(e)},!0)},N="function"==typeof WeakSet?new WeakSet:new Set,U=function(e,t,n){var i;return function(){0<=t.value&&(n||N.has(t)||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),(t.delta||void 0===i)&&(i=t.value,e(t)))}},l=-1,f=function(){return"hidden"===document.visibilityState?0:1/0},m=function(){M(function(e){var t=e.timeStamp;l=t},!0)},j=function(){return l<0&&(l=f(),m(),q(function(){setTimeout(function(){l=f(),m()},0)})),{get timeStamp(){return l}}},v={passive:!0,capture:!0},h=new Date,g=function(e,t){k||(k=t,D=e,a=new Date,F(removeEventListener),W())},W=function(){if(0<=D&&D<a-h){var t={entryType:"first-input",name:k.type,target:k.target,cancelable:k.cancelable,startTime:k.timeStamp,processingStart:k.timeStamp+D};A.forEach(function(e){e(t)}),A=[]}},w=function(e){if(e.cancelable){var t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(n=t,i=e,a=function(){g(n,i),r()},o=function(){r()},r=function(){removeEventListener("pointerup",a,v),removeEventListener("pointercancel",o,v)},addEventListener("pointerup",a,v),addEventListener("pointercancel",o,v)):g(t,e)}var n,i,a,o,r},F=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,w,v)})};function _(t){var e=window.MNB;if(!e||!e.addMethod)return t(new Error("mnb sdk missing"));e.addMethod({schema:"performance.getInfo",name:"getClientPerformance"});var n=setTimeout(function(){if(n)return t(new Error("mnb performance.getInfo timeout"))},200),i=function(){n&&(clearTimeout(n),n=void 0)};e.getClientPerformance({},function(e){i(),t(null,e)},function(e){i(),t(new Error("mnb performance.getInfo failed:"+e.message))})}function z(n){var i={navTiming:function(){var e=window.performance&&window.performance.timing||{},t={};for(var n in e)"toJSON"!==n&&(t[n]=e[n]);return t}()};if(window.PRELOAD&&window.PRELOAD.timing)return i.preload=window.PRELOAD.timing,n(i);_(function(e,t){return e||(i.clientTiming=t),n(i)})}var y="https://sentry.music.163.com/wapm",S="/api/sdk/collectConfig",b="/api/sdk/collect",E=y+S,L=y+b,T="_mwapm_uid",P="_WAPM_CACHE",O=["longtask","image"],B=["longtask","image","webVitals"];function H(){this._key=null,this._isInstalled=!1,this._pid=null,this._version="1.6.3-alpha.1",this._globalOptions={traceResource:!1,traceLongtask:!0,enableSPA:!1,hashSPA:!1,debug:!1,syncConfig:!0,ignoreUrlPath:[{rule:/\/\d+\//g,target:"/**/"},{rule:/\/\d+\//g,target:"/**/"},{rule:/\/\d+$/g,target:"/**"}],traceImage:!0,warningImageSize:10,filterCropImg:!0,hasCropParams:e,sampleRate:1,vitalsBadline:{LCP:3500,CLS:.2,FID:300},pendingRequest:!1},this._payloadTransform=function(e){return e},this._cache=new V,this._fetchDefaults={method:"POST",headers:{"Content-type":"application/json"}},this._uploadedImage={},this._requestCache=[]}function V(){this._pidMap={},this._handlerMap={},this._intervalMap={}}return H.prototype={debug:!1,install:function(e,t){var n,i,a,o,r,s,c=this;if(c._isInstalled)c._logDebug("warn","Warn: music-apm has already been installed");else{if(!e)return void console.error("错误: musicapm安装失败，请传递参数appkey");if(c._key=e,c._onLoadHandlers=[],window[P]&&window[P].loginUser&&c.login(window[P].loginUser),t&&C(t,function(e,t){var n;"sampleRate"===e&&(!(n=t)||n<0||1<n)&&(t=1),c._globalOptions[e]=t}),Math.random()>c._globalOptions.sampleRate)return;if(c._isInstalled=!0,function(e){if(window.dispatchEvent){var t=document.createEvent("Event");t.initEvent(e,!0,!0),window.dispatchEvent(t)}else console.log("window.dispatchEvent is not available")}("music_apm_installed"),c._globalOptions.uploadServer&&(y=c._globalOptions.uploadServer,E=y+S,L=y+b),s=window.location.hostname,/(baechat\.my|kayalive\.tv|mimotest\.top|meety\.my)/.test(s)){var u=y.includes("qa-wapm.igame.163.com");n=u,i={test:"//qa.meety.my",online:"//api.baechat.my"},a={test:"//qa.mimotest.top",online:"//api.kayalive.tv"},o=window.location.hostname,r=a.online,C({"meety.my":i,"baechat.my":i,"mimotest.top":a,"kayalive.tv":a},function(e,t){o.includes(e)&&(r=n?t.test:t.online)}),E=(y=r)+"/api/wapm-sdk/collectConfig",L=y+"/api/wapm-sdk/collect"}c._globalOptions.enableSPA&&c._traceSPA(),c.tracePageView(),c._globalOptions.syncConfig?c._syncServerConfig(function(){c._startTrace(),c._startUpload()}):(c._startTrace(),c._startUpload())}return c},_traceSPA:function(){var i=this,e=function(t,e){if(t[e]){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);return i.tracePageView(),e}}};e(window.history,"pushState"),e(window.history,"replaceState"),window.addEventListener("popstate",function(){i.tracePageView()})},_syncServerConfig:function(n){var i=this,e={url:E,method:"GET",payload:{appKey:i._key},onSuccess:function(e){var t=e&&e.result;i._globalOptions.traceResource=t&&t.traceResource,i._globalOptions.traceLongtask=t&&t.traceLongtask,n()},onError:function(e){i._globalOptions.traceResource=!1,i._globalOptions.traceLongtask=!1,i._logDebug("error",e),n()}};i._makeRequest(e)},_startTrace:function(){this._traceNavigation(),this._traceWebVitals();var e=this._globalOptions;e.traceLongtask&&this._traceLongtask(),e.traceImage&&this._traceImage()},_startUpload:function(){var i=this;C(i._onLoadHandlers,function(e,t){"complete"===document.readyState?t():window.addEventListener?window.addEventListener("load",t):document.attachEvent&&window.attachEvent("onload",t)});var e,a=i._globalOptions;C(O,function(e,n){var t;a["trace"+(t=n,t[0].toUpperCase()+t.slice(1))]&&i._cache.subscribeTiming(n,function(e,t){i._upload(e,n,t)},5e3)});var t=window[P];if(t&&t.eventList?e=t.eventList:window._wapm_cache&&(e=window._wapm_cache),e&&e.length){var n=[];C(e,function(e,t){t&&t.name?n.push(t):this._logDebug("warn","WAPM::uploadEvent fail: absence of event.name")}),i._uploadEvents(n)}},_traceNavigation:function(){var i=this,t=!1,a=function(){var e=window.performance&&window.performance.timing;if(e&&(!t||0!==e.loadEventStart))if(0!==e.loadEventStart&&0!==e.domInteractive){i._navigationStart=e.navigationStart;var n={};n.begin=e.navigationStart,n.unload=e.unloadEventEnd-e.unloadEventStart,n.redirect=e.fetchStart-e.navigationStart,n.dns=e.domainLookupEnd-e.domainLookupStart,n.tcp=e.connectEnd-e.connectStart,n.ssl=e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:0,n.ttfb=e.responseStart-e.requestStart,n.trans=e.responseEnd-e.responseStart,n.dom=e.domInteractive-e.responseEnd,n.res=e.loadEventStart-e.domContentLoadedEventEnd,n.firstbyte=e.responseStart-e.domainLookupStart,n.fpt=e.responseEnd-e.navigationStart,n.tti=e.domInteractive-e.navigationStart,n.ready=e.domContentLoadedEventEnd-e.navigationStart,n.load=e.loadEventStart-e.navigationStart,n.retry=t?1:0,C(n,function(e,t){"begin"!==e&&t>n.begin&&(n[e]=t-n.begin)}),s()?function(e){if(s()){var t=(n=0,function(){if(window.PRELOAD.timing)return e(null,window.PRELOAD.timing);n<=2?(n++,setTimeout(t,200)):e(new Error("get preload timing timeout"))});t()}else e(new Error("cant get preload timing, please check window.PRELOAD has exist ?"));var n}(function(e,t){if(e)return i._logDebug("warn","WAPM::preload"+e.message),void i._upload(i._pid,"navigation",[n]);i._upload(i._pid,"navigationPreload",[n,t])}):_(function(e,t){if(e)return i._logDebug("warn","WAPM::mnb "+e.message),void i._upload(i._pid,"navigation",[n]);i._upload(i._pid,"navigation",[n,t])})}else t||(t=!0,setTimeout(a,1e3))};i._onLoadHandlers.push(a)},_traceResource:function(){var t=this;t._onLoadHandlers.push(function(){try{var e=window.performance.getEntriesByType("resource");t._upload(t._pid,"resource",(i=[],C(e,function(e,t){if(!t.name.startsWith(L)&&!t.name.startsWith(E)){var n={};n.name=t.name,n.type=t.initiatorType,n.encodedBodySize=t.encodedBodySize,n.startTime=t.startTime,n.duration=t.duration,n.dns=t.domainLookupEnd-t.domainLookupStart,n.tcp=t.connectEnd-t.connectStart,n.ttfb=t.responseStart-t.requestStart,n.trans=t.responseStart?t.responseEnd-t.responseStart:0,i.push(n)}}),i))}catch(e){t._logDebug("warn","warn: 浏览器不支持获取resource timing,"+e)}var i})},_traceLongtask:function(){var a=this;this._observerTiming("longtask",function(e){var i=[];return C(e,function(e,t){var n={};n.navigationStart=a._navigationStart,n.startTime=t.startTime,n.duration=t.duration,n.name=t.name,"self"!==t.name&&(n.containerSrc=t.attribution[0].containerSrc),i.push(n)}),i})},_traceImage:function(){var n=this,t=function(e){return e.filter(function(e){if("css"!==e.initiatorType&&"img"!==e.initiatorType)return!1;if(t=e.name,!/p[1-6]c?\.music\.126\.net|s[1-8]c?\.music\.126\.net/i.test(t))return!1;var t;if("wapm_ignore"in i(e.name))return!1;try{if(n._globalOptions.filterCropImg&&n._globalOptions.hasCropParams&&n._globalOptions.hasCropParams(e.name,i(e.name)))return!1}catch(e){n._logDebug("error",e)}return!(!e.transferSize||e.transferSize<1024*n._globalOptions.warningImageSize)&&(!n._uploadedImage[e.name]&&(n._uploadedImage[e.name]=!0))}).map(function(e){var t="";"img"===e.initiatorType&&(t=function(e){if(e instanceof window.Element){for(var t=[];e.nodeType===window.Node.ELEMENT_NODE;){var n=e.nodeName.toLowerCase(),i=n,a=e.className.trim();if(a&&(i+="."+a),e.id&&(i+="#"+e.id),!s([i].concat(t))){for(var o=e,r=1;o=o.previousElementSibling;)o.nodeName.toLowerCase()===n&&r++;i+=":nth-of-type("+r+")"}if(t.unshift(i),s(t))break;e=e.parentNode}return t.join(" > ")}function s(e){try{return 1===document.querySelectorAll(e.join(" > ")).length}catch(e){return!0}}}(document.querySelector('img[src="'+e.name+'"]')));return{name:e.name,transferSize:e.transferSize,initiatorType:e.initiatorType,domPath:t}})};n._onLoadHandlers.push(function(){try{var e=window.performance.getEntriesByType("resource");n._cache.pushTiming(n._pid,"image",t(e))}catch(e){n._logDebug("warn","warn: 浏览器不支持获取resource timing,"+e)}}),this._observerTiming("image",function(e){return t(e)})},_traceWebVitals:function(){var t,n,i,a,o,r,e,s,c,u,l,d,p,f,m,v,h,g,w,_=this,y={DETAIL:{}},S=["FCP","LCP"],b=window.PRELOAD&&window.PRELOAD.timing?window.PRELOAD.timing.show-window.performance.timing.navigationStart:0;function E(){z(function(e){y.EXTRA=e})}function L(e){var t=e.name,n=S.includes(t)?e.value-b:e.value;y[t]=n;var i,a=_._globalOptions.vitalsBadline;if(a&&a[t]&&n>=a[t]){var o,r,s=y.DETAIL;switch(t){case"LCP":if(!(r=e.entries[e.entries.length-1]))return;o={largestContentfulPaint:n,largestContentfulElement:R(r.element),largestContentfulElementSize:r.size};break;case"FID":if(!(r=e.entries[0]))return;o={firstInputDelay:e.value,firstInputName:r.name,firstInputTime:r.startTime,firstInputElement:R(r.target)};break;case"CLS":var c=[],u=0;C(e.entries,function(e,t){var n,i;c.push({value:t.value,startTime:t.startTime,sources:(n=t.sources,i=[],n&&C(n,function(e,t){i.push({currentRect:JSON.stringify(t.currentRect),previousRect:JSON.stringify(t.previousRect),node:R(t.node)})}),i)}),t.value>u&&(u=t.value)}),o={cumulativeLayoutShift:e.value,largestLayoutShift:u,totalLayoutShifts:c,viewport:(i=document.scrollingElement,i?{width:i.clientWidth,height:i.clientHeight}:null)}}s[t]=o}}"complete"===document.readyState?E():window.addEventListener("load",E),t=L,a=j(),o=I("FCP"),(r=x("paint",function(e){"first-contentful-paint"===e.name&&(r&&r.disconnect(),e.startTime<a.timeStamp&&(o.value=e.startTime,o.entries.push(e),N.add(o),i()))}))&&(i=U(t,o,n),q(function(e){o=I("FCP"),i=U(t,o,n),requestAnimationFrame(function(){requestAnimationFrame(function(){o.value=performance.now()-e.timeStamp,N.add(o),i()})})})),function(t,n){var i,a=j(),o=I("LCP"),e=function(e){var t=e.startTime;t<a.timeStamp&&(o.value=t,o.entries.push(e)),i()},r=x("largest-contentful-paint",e);if(r){i=U(t,o,n);var s=function(){N.has(o)||(r.takeRecords().map(e),r.disconnect(),N.add(o),i())};["keydown","click"].forEach(function(e){addEventListener(e,s,{once:!0,capture:!0})}),M(s,!0),q(function(e){o=I("LCP"),i=U(t,o,n),requestAnimationFrame(function(){requestAnimationFrame(function(){o.value=performance.now()-e.timeStamp,N.add(o),i()})})})}}(L),e=L,u=I("CLS",0),(d=x("layout-shift",l=function(e){e.hadRecentInput||(u.value+=e.value,u.entries.push(e),c())}))&&(c=U(e,u,s),M(function(){d.takeRecords().map(l),c()}),q(function(){u=I("CLS",0),c=U(e,u,s)})),p=L,v=j(),h=I("FID"),w=x("first-input",g=function(e){e.startTime<v.timeStamp&&(h.value=e.processingStart-e.startTime,h.entries.push(e),N.add(h),m())}),m=U(p,h,f),w&&M(function(){w.takeRecords().map(g),w.disconnect()},!0),w&&q(function(){var e;h=I("FID"),m=U(p,h,f),A=[],D=-1,k=null,F(addEventListener),e=g,A.push(e),W()});var T=!1,P=_._pid;function O(){y.LCP&&y.EXTRA&&!T&&(_._upload(P,"webVitals",[y],!0),T=!0)}window.addEventListener&&setTimeout(function(){!function(e){if(-1!==(window.PerformanceObserver&&window.PerformanceObserver.supportedEntryTypes||[]).indexOf("layout-shift")){var t=function(){"hidden"===document.visibilityState&&(e(),window.removeEventListener("visibilitychange",t,!0))};window.addEventListener("visibilitychange",t,!0)}else window.addEventListener("pagehide",e,{capture:!0,once:!0})}(O)})},_observerTiming:function(n,i){if(window.PerformanceObserver){var a=this,e=new window.PerformanceObserver(function(e){var t=i?i(e.getEntries()):e.getEntries();t&&0<t.length&&a._cache.pushTiming(a._pid,n,t)}),t="image"===n?"resource":n;try{e.observe({entryTypes:[t]})}catch(e){a._logDebug("warn","warn: 浏览器不支持检测"+t)}}},_upload:function(e,t,n,i){if(this._isInstalled){var a,o,r=this,s={},c=(a=t,o=!1,C(B,function(e,t){t===a&&(o=!0)}),o?r._cache.getLocation(e):window.location),u=c&&c.host+c.pathname+(r._globalOptions.hashSPA?c.hash:"");u=p(u,r._globalOptions.ignoreUrlPath),d(s,{appKey:r._key,dataType:t,data:n,uid:r._getUserId(),pid:e,href:c&&c.href,url:u,sampleRate:r._globalOptions.sampleRate,version:r._version,network:r._getNetwork(),hashSpa:r._globalOptions.hashSPA});var l={url:L,payload:s,onError:function(e){r._logDebug("error",e)},useBeacon:i};r._globalOptions.pendingRequest?r._requestCache.push(l):r._makeRequest(l)}},_makeRequest:function(t){var n=this;t.payload=n._payloadTransform(d({},t.payload))||t.payload;var e=t.url;if("GET"===t.method&&(e=e+"?"+function(e){if("object"!=typeof e)return"";var n="";return C(e,function(e,t){n+=e+"="+encodeURIComponent(t)+"&"}),n.slice(0,n.length-1)}(t.payload)),"sendBeacon"in navigator&&t.useBeacon)return navigator.sendBeacon(e,JSON.stringify(t.payload));if(function(){if(!("fetch"in window))return!1;try{new Headers,new Request(""),new Response}catch(e){return!1}return!0}()){var i={};return t.method&&"GET"===t.method||(i=d({body:JSON.stringify(t.payload)},this._fetchDefaults)),window.fetch(e,i).then(function(e){if(e.ok)return e.json();var t=new Error("APM error code:"+e.status);throw t.request=e,t}).then(function(e){t.onSuccess&&t.onSuccess(e)}).catch(function(e){n._logDebug("error",e),t.onError&&t.onError(e)})}var a=window.XMLHttpRequest&&new window.XMLHttpRequest;a&&(("withCredentials"in a||"undefined"!=typeof XDomainRequest)&&("withCredentials"in a?a.onreadystatechange=function(){if(4!==a.readyState);else if(200===a.status)t.onSuccess&&t.onSuccess();else if(t.onError){var e=new Error("APM error code:"+a.status);e.request=a,t.onError(e)}}:window.XDomainRequest&&(a=new window.XDomainRequest,e=e.replace(/^https?:/,""),t.onSuccess&&(a.onload=t.onSuccess),t.onError&&(a.onerror=function(){var e=new Error("APM error code: XDomainRequest");e.request=a,t.onError(e)})),"GET"===t.method?(a.open("GET",e),a.send()):(a.open("POST",e),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(t.payload)))))},_logDebug:function(e){console[e]&&(this.debug||this._globalOptions.debug)&&Function.prototype.apply.call(console[e],console,[].slice.call(arguments,1))},login:function(e){e&&"string"==typeof e&&this._setUserId(e)},_setUserId:function(e){var t,n,i,a,o,r,s;window.localStorage?window.localStorage.setItem(T,e):(t=T,n=e,i=new Date(Date.now()+31536e6),a="/",s=encodeURIComponent(t)+"="+encodeURIComponent(n),i instanceof Date&&(s+="; expires="+i.toGMTString()),a&&(s+="; path="+a),o&&(s+="; domain="+o),r&&(s+="; secure"),document.cookie=s)},_getUserId:function(){var e=null;return(e=window.localStorage?window.localStorage.getItem(T):function(e){var t=encodeURIComponent(e)+"=",n=document.cookie.indexOf(t),i=null;if(-1<n){var a=document.cookie.indexOf(";",n);-1===a&&(a=document.cookie.length),i=decodeURIComponent(document.cookie.substring(n+t.length,a))}return i}(T))||(e=t(),this._setUserId(e)),e},_getNetwork:function(){var e=navigator.connection;return e?{effectiveType:e.effectiveType,rtt:e.rtt}:null},tracePageView:function(){this._pid=t(),this._cache.initCache(this._pid),this._upload(this._pid,"pv")},traceEvent:function(e,t){this._logDebug("warn","WAPM::traceEvent is depressed, please use uploadEvent instead"),this._upload(this._pid,"event",[{name:e,attributes:t}])},uploadEvent:function(e){e&&e.name?this._uploadEvents([{name:e.name,attributes:e.attributes,value:e.value}]):this._logDebug("warn","WAPM::uploadEvent fail: absence of event.name")},uploadEvents:function(e){if(e&&o(e)){var n=!1;C(e,function(e,t){t.name||(n=!0)}),n?this._logDebug("warn","WAPM::uploadEvents fail: absence of event.name"):this._uploadEvents(e)}else this._logDebug("warn","WAPM::uploadEvents fail: should pass array")},_uploadEvents:function(e){this._upload(this._pid,"event",e)},setPayloadTransform:function(e){if(e){var n=this;n._payloadTransform=function(t){try{return e(t)}catch(e){return n._logDebug("error",e),t}}}},flushPendingRequest:function(){var n=this;n._globalOptions.pendingRequest=!1,n._requestCache.length&&(C(n._requestCache,function(e,t){n._makeRequest(t)}),n._requestCache.length=0)}},V.prototype={initCache:function(e){var n={};return C(O,function(e,t){n[t]=[]}),this._pidMap[e]={cache:n,location:JSON.parse(JSON.stringify(window.location))},this._pidMap[e]},getLocation:function(e){return this._pidMap[e]&&this._pidMap[e].location},_getPidCache:function(e){return this._pidMap[e]||this.initCache(e),this._pidMap[e].cache},pushTiming:function(e,n,t){var i=this._getPidCache(e);o(t)?C(t,function(e,t){i[n].push(t)}):i[n].push(t)},subscribeTiming:function(i,a,e){var t=this,n=t._intervalMap[i];n&&clearInterval(n);var o=function(){C(t._pidMap,function(e,t){var n=t.cache[i];n&&0<n.length&&a(e,n.splice(0,n.length))})};e&&(t._intervalMap[i]=setInterval(o,e)),t._handlerMap[i]=o}},new H}();
